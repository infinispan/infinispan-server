<?xml version="1.0" encoding="UTF-8"?>

<plugin name="JDG" displayName="JBoss Data Grid" description="Supports management and monitoring of JBoss Data Grid" package="com.jboss.datagrid.rhq" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="urn:xmlns:rhq-plugin" xmlns:c="urn:xmlns:rhq-configuration">

   <depends plugin="JBossAS7" useClasses="true" />

   <service name="DataGrid" discovery="org.rhq.modules.plugins.jbossas7.SubsystemDiscovery" class="com.jboss.datagrid.rhq.JDGComponent" singleton="true">

      <runs-inside>
         <parent-resource-type name="Profile" plugin="JBossAS7" />
         <parent-resource-type name="JBossAS7 Standalone Server" plugin="JBossAS7" />
         <parent-resource-type name="Managed Server" plugin="JBossAS7" />
      </runs-inside>

      <plugin-configuration>
         <c:simple-property name="path" readOnly="true" default="subsystem=datagrid" />
         <c:simple-property name="managedRuntime" default="true" type="boolean" readOnly="true" />
      </plugin-configuration>

      <service name="Connector" discovery="org.rhq.modules.plugins.jbossas7.SubsystemDiscovery" class="com.jboss.datagrid.rhq.JDGConnector" createDeletePolicy="both" creationDataType="configuration">

         <plugin-configuration>
            <c:simple-property name="path" readOnly="true" default="hotrod-connector|memcached-connector" />
         </plugin-configuration>

         <metric property="bytesRead" displayName="Bytes Read" displayType="detail" units="none" dataType="measurement" description="Bytes Read" />
         <metric property="bytesWritten" displayName="Bytes Written" displayType="detail" units="none" dataType="measurement" description="Bytes Written" />

         <resource-configuration>
            <c:simple-property name="cache-container" required="true" type="string" readOnly="true" description="The cache container used by this connector" />
            <c:simple-property name="socket-binding" required="true" type="string" readOnly="true" description="The socket binding used by this connector" />
         </resource-configuration>

      </service>
   </service>

   <service name="Infinispan" discovery="org.rhq.modules.plugins.jbossas7.SubsystemDiscovery" class="com.jboss.datagrid.rhq.IspnComponent" singleton="true">

      <runs-inside>
         <parent-resource-type name="Profile" plugin="JBossAS7" />
         <parent-resource-type name="JBossAS7 Standalone Server" plugin="JBossAS7" />
         <parent-resource-type name="Managed Server" plugin="JBossAS7" />
      </runs-inside>

      <plugin-configuration>
         <c:simple-property name="path" readOnly="true" default="subsystem=infinispan" />
         <c:simple-property name="managedRuntime" default="true" type="boolean" readOnly="true" />
      </plugin-configuration>

      <service name="Cache Container" discovery="org.rhq.modules.plugins.jbossas7.SubsystemDiscovery" class="com.jboss.datagrid.rhq.IspnCContainerComponent" createDeletePolicy="both" creationDataType="configuration">

         <plugin-configuration>
            <c:simple-property name="path" readOnly="true" default="cache-container" />
         </plugin-configuration>

         <metric property="cacheManagerStatus" displayName="Cache Container Status" displayType="summary" units="none" dataType="trait" description="The current runtime status of a cache container" />
         <metric property="clusterName" displayName="Cluster Name" displayType="summary" units="none" dataType="trait" description="The name of the cluster" />
         <metric property="coordinatorAddress" displayName="Coordinator Address" displayType="summary" units="none" dataType="trait" description="The coordinator node's address" />
         <metric property="localAddress" displayName="Local Address" displayType="summary" units="none" dataType="trait" description="The local node's address" />

         <resource-configuration>
            <c:simple-property name="default-cache" required="false" type="string" readOnly="false" description="The default infinispan cache" />
        <!-- TODO select from child cache services -->
            <c:list-property name="aliases" required="false" description="The list of aliases for this cache container">
               <c:simple-property name="alias" />
            </c:list-property>
            <c:simple-property name="jndi-name" required="false" type="string" readOnly="false" description="The jndi name to which to bind this cache container" />
            <c:simple-property name="start" required="false" type="string" readOnly="false" defaultValue="LAZY" description="The cache container start mode, which can be EAGER (immediate start) or LAZY (on-demand start).">
               <c:property-options>
                  <c:option value="LAZY" />
                  <c:option value="EAGER" />
               </c:property-options>
            </c:simple-property>
            <c:simple-property name="listener-executor" required="false" type="string" readOnly="false" description="The executor used for the replication queue" />
            <c:simple-property name="eviction-executor" required="false" type="string" readOnly="false" description="The scheduled executor used for eviction" />
            <c:simple-property name="replication-queue-executor" required="false" type="string" readOnly="false" description="The executor used for asynchronous cache operations" />
         </resource-configuration>

         <service name="Cache" discovery="org.rhq.modules.plugins.jbossas7.SubsystemDiscovery" class="IspnCacheComponent" createDeletePolicy="both" creationDataType="configuration">

            <plugin-configuration>
               <c:simple-property name="path" readOnly="true" default="distributed-cache|local-cache|invalidation-cache|replicated-cache" />
            </plugin-configuration>

            <metric property="cacheStatus" displayName="Cache Status" displayType="summary" units="none" dataType="trait" description="The current runtime status of a cache" />

            <metric property="numberOfLocksAvailable" displayName="[LockManager] Number of locks available" displayType="detail" units="none" dataType="measurement" description="The number of exclusive locks that are available." />
            <metric property="numberOfLocksHeld" displayName="[LockManager] Number of locks held" displayType="detail" units="none" dataType="measurement" description="The number of exclusive locks that are held." />
            <metric property="concurrencyLevel" displayName="[LockManager] Concurrency level" displayType="detail" units="none" dataType="trait" description="The concurrency level that the Lock Manager has been configured with." />

            <metric property="averageReadTime" displayName="[Statistics] Average read time" displayType="summary" units="milliseconds" dataType="measurement" description="Average number of milliseconds for a read operation on the cache" />
            <metric property="hitRatio" displayName="[Statistics] Hit ratio" displayType="summary" units="percentage" dataType="measurement" description="Percentage hit/(hit+miss) ratio for the cache" />
            <metric property="elapsedTime" displayName="[Statistics] Seconds since cache started" displayType="summary" units="seconds" dataType="measurement" description="Number of seconds since cache started" />
            <metric property="readWriteRatio" displayName="[Statistics] Read/write ratio" displayType="summary" units="percentage" dataType="measurement" description="read/writes ratio for the cache" />
            <metric property="averageWriteTime" displayName="[Statistics] Average write time" displayType="summary" units="milliseconds" dataType="measurement" description="Average number of milliseconds for a write operation in the cache" />
            <metric property="hits" displayName="[Statistics] Number of cache hits" displayType="summary" units="none" dataType="measurement" description="Number of cache attribute hits" />
            <metric property="evictions" displayName="[Statistics] Number of cache evictions" displayType="summary" units="none" dataType="measurement" description="Number of cache eviction operations" />
            <metric property="removeMisses" displayName="[Statistics] Number of cache removal misses" displayType="summary" units="none" dataType="measurement" description="Number of cache removals where keys were not found" />
            <metric property="timeSinceReset" displayName="[Statistics] Seconds since cache statistics were reset" displayType="summary" units="seconds" dataType="measurement" description="Number of seconds since the cache statistics were last reset" />
            <metric property="numberOfEntries" displayName="[Statistics] Number of current cache entries" displayType="summary" units="none" dataType="measurement" description="Number of entries currently in the cache" />
            <metric property="stores" displayName="[Statistics] Number of cache puts" displayType="summary" units="none" dataType="measurement" description="number of cache attribute put operations" />
            <metric property="removeHits" displayName="[Statistics] Number of cache removal hits" displayType="summary" units="none" dataType="measurement" description="Number of cache removal hits" />
            <metric property="misses" displayName="[Statistics] Number of cache misses" displayType="summary" units="none" dataType="measurement" description="Number of cache attribute misses" />

            <metric property="successRatio" displayName="[RpcManager] Successful replication ratio" displayType="summary" units="percentage" dataType="measurement" description="Successful replications as a ratio of total replications in numeric double format" />
            <metric property="replicationCount" displayName="[RpcManager] Number of successful replications" displayType="summary" units="none" dataType="measurement" description="Number of successful replications" />
            <metric property="replicationFailures" displayName="[RpcManager] Number of failed replications" displayType="summary" units="none" dataType="measurement" description="Number of failed replications" />
            <metric property="averageReplicationTime" displayName="[RpcManager] Average time spent in the transport layer" displayType="summary" units="milliseconds" dataType="measurement" description="The average time spent in the transport layer, in milliseconds" />

            <metric property="commits" displayName="[Transactions] Commits" displayType="summary" units="none" dataType="measurement" description="Number of transaction commits performed since last reset" />
            <metric property="prepares" displayName="[Transactions] Prepares" displayType="summary" units="none" dataType="measurement" description="Number of transaction prepares performed since last reset" />
            <metric property="rollbacks" displayName="[Transactions] Rollbacks" displayType="summary" units="none" dataType="measurement" description="Number of transaction rollbacks performed since last reset" />

            <metric property="invalidations" displayName="[Invalidation] Number of invalidations" displayType="detail" units="none" dataType="measurement" description="Number of invalidations" />
            <metric property="passivations" displayName="[Passivation] Number of cache passivations" displayType="detail" units="none" dataType="measurement" description="Number of passivation events" />
            <metric property="activations" displayName="[Activation] Number of cache entries activated" displayType="detail" units="none" dataType="measurement" description="Number of activation events" />
            <metric property="cacheLoaderLoads" displayName="[Activation] Number of cache store loads" displayType="detail" units="none" dataType="measurement" description="Number of entries loaded from cache store" />
            <metric property="cacheLoaderMisses" displayName="[Activation] Number of cache store load misses" displayType="detail" units="none" dataType="measurement" description="Number of entries that did not exist in cache store" />

            <resource-configuration>
               <c:simple-property name="_flavor" displayName="Kind of cache" required="true" readOnly="true" default="local-cache" description="What special kind of cache is this.">
                  <c:property-options>
                     <c:option value="local-cache" />
                     <c:option value="invalidation-cache" />
                     <c:option value="distributed-cache" />
                     <c:option value="replicated-cache" />
                  </c:property-options>
               </c:simple-property>
               <c:simple-property name="start" required="false" type="string" readOnly="false" default="LAZY" description="The cache start mode, which can be EAGER (immediate start) or LAZY (on-demand start).">
                  <c:property-options>
                     <c:option value="LAZY" />
                     <c:option value="EAGER" />
                  </c:property-options>
               </c:simple-property>
               <c:simple-property name="batching" required="false" type="boolean" readOnly="false" default="false" description="If enabled, the invocation batching API will be made available for this cache." />
               <c:simple-property name="indexing" required="false" type="string" readOnly="false" default="NONE" description="If enabled, entries will be indexed when they are added to the cache. Indexes will be updated as entries change or are removed.">
                  <c:property-options>
                     <c:option value="NONE" />
                     <c:option value="LOCAL" />
                     <c:option value="ALL" />
                  </c:property-options>
               </c:simple-property>
               <c:simple-property name="jndi-name" required="false" type="string" readOnly="false" description="The jndi-name to which to bind this cache instance." />
               <c:simple-property name="mode" required="false" type="string" readOnly="true" default="SYNC" description="Sets the clustered cache mode, ASYNC for asynchronous operation, or SYNC for synchronous operation.">
                  <c:property-options>
                     <c:option value="SYNC" />
                     <c:option value="ASYNC" />
                  </c:property-options>
               </c:simple-property>
               <c:simple-property name="queue-size" required="false" type="integer" readOnly="false" default="0" description="In ASYNC mode, this attribute can be used to trigger flushing of the queue when it reaches a specific threshold." />
               <c:simple-property name="queue-flush-interval" required="false" type="long" readOnly="false" default="10"
                  description="In ASYNC mode, this attribute controls how often the asynchronous thread used to flush the replication queue runs. This should be a positive integer which represents thread wakeup time in milliseconds." />
               <c:simple-property name="remote-timeout" required="false" type="long" readOnly="false" default="17500" description="In SYNC mode, the timeout (in ms) used to wait for an acknowledgment when making a remote call, after which the call is aborted and an exception is thrown." />
            </resource-configuration>
         </service>
      </service>

   </service>
</plugin>